liveChinaApp.controller("liveList",["$scope","$http","API_URL_ROOT","$routeParams","$location","$timeout","$interval","$window",function(e,t,n,o,i,a,c,r){document.documentElement.clientHeight;e.id=o.id,e.time_status=o.time_status,e.tag="interaction",e.offset=0,e.count=6,e.loading=!0,e.commit="",e.showTotalMessage=!1,e.touched=!1,e.share_url="",e.changeIntroduce=function(t){e.tag=t,"introduce"===t?angular.element(document.querySelector("#underLine")).addClass("toLeft").removeClass("toRight").removeClass("underLine"):angular.element(document.querySelector("#underLine")).removeClass("toLeft").addClass("toRight").removeClass("underLine")},e.goBack=function(){history.back()},t({method:"JSONP",url:"http://operate.tw.live.hoge.cn?callback=JSON_CALLBACK&m=Apituwenol&c=tuwenol&a=detail&custom_appkey=G8FHXedPgl4i7sA2rfUISxfaB0NB5WJC&custom_appid=83&id="+e.id}).success(function(t){e.share_url=t.share_url,e.videoUrl=t[0].live_info[0].url,console.log(e.videoUrl),e.loading=!1,e.dataList=t,e.getComment()}),e.addSrc=function(t){t.target.src=e.videoUrl},e.totalMessage=function(){if(1==e.time_status){var t=(new Date).getTime();t>1e3*e.dataList[0].end_time&&t<1e3*e.dataList[0].end_time+1e3&&(e.showTotalMessage=!0)}},e.commitArr=[],e.getComment=function(){e.loading=!0,e.offset+=3,t({method:"JSONP",url:n+"?m=Apituwenol&c=thread&a=show_comment&callback=JSON_CALLBACK&custom_appkey=G8FHXedPgl4i7sA2rfUISxfaB0NB5WJC&custom_appid=83&order=desc&offset="+e.offset+"&count="+e.count}).success(function(t){if(t.length>0)if(t.filter(function(e,t,n){e.user_name.length>4&&(e.user_name=e.user_name.slice(0,2)+"..."+e.user_name.slice(e.user_name.length-2))}),0==e.commitArr.length)Array.prototype.unshift.apply(e.commitArr,t),console.log(e.commitArr[0].id);else for(var n=0;n<e.commitArr.length;n++)for(var o=0;o<t.length;o++)console.log("输出"),e.commitArr[n].id!=t[o].id&&e.commitArr.unshift(t[o]);else e.offset=e.commitArr.length-1,e.offset<0?e.offset=0:e.offset=e.offset;e.loading=!1})},e.changeTime=function(e){var t=new Date(e).getTime(),n=(new Date).getTime(),o=parseInt((n-t)/1e3/60);return(n-t)/1e3>0&&(n-t)/1e3<60?"一分钟内":o>0&&o<60?parseInt(o)+"分钟前":o/60>0&&o/60<23?parseInt(o/60)+"小时前":e.substr(0,10)};var s=0;e.see=function(){e.totalMessage(),s++,"interaction"==e.tag&&s%3==0&&0!=e.time_status&&(e.getComment(),e.scrollDiv())},c(e.see,1e3),e.sendMessage=function(o){if(e.content=o.target.name,""==e.content||void 0==e.content||null==e.content)return!1;o.target.innerHTML="发表...",console.log(e.id),t({method:"JSONP",url:n+"?&callback=JSON_CALLBACK&m=Apituwenol&c=interact&a=show&type=comment&custom_appkey=G8FHXedPgl4i7sA2rfUISxfaB0NB5WJC&custom_appid=83&content="+e.content+"&topic_id="+e.id}).success(function(t){console.log(t),o.target.innerHTML="发表",angular.element(document.querySelector("#input")).val(""),o.target.name="",e.getComment()})},e.share=function(){SmartCity.shareTo({title:"标题",brief:"描述",contentURL:e.share_url,imageLink:"http://img1.bdstatic.com/img/image/shitu/feimg/uploading.gif"})},e.cancelModal=function(){e.showTotalMessage=!1},e.touchStart=function(t){e.touched=!e.touched,console.log(t)},e.scrollDiv=function(){}}]),liveChinaApp.directive("myTouchstart",[function(){return function(e,t,n){t.on("touchstart",function(t){e.$apply(function(){e.$eval(n.myTouchstart)})})}}]),liveChinaApp.directive("myTouchend",[function(){return function(e,t,n){t.on("touchend",function(t){e.$apply(function(){e.$eval(n.myTouchend)})})}}]);